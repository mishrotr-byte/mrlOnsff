<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>mrlOnsf</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--bg:#0a0a14;--dark:#11111a;--orange:#ff6a00;--glow:#ff8c33;--text:#f0f0f0}
    body,html{margin:0;height:100vh;overflow:hidden;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,sans-serif}
    #particles{position:fixed;inset:0;pointer-events:none;z-index:1}
    .cube{position:absolute;width:10px;height:10px;background:var(--orange);box-shadow:0 0 20px var(--glow);border-radius:2px;animation:float 3s infinite}
    @keyframes float{0%,100%{opacity:.7;transform:translateY(0) rotate(0)}50%{opacity:1;transform:translateY(-25px) rotate(180deg)}}

    #auth{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:20px;z-index:999}
    .logo{font-size:56px;font-weight:900;background:linear-gradient(45deg,#ff6a00,#ff9a33);-webkit-background-clip:text;color:transparent}
    .abtn{width:280px;padding:16px;border-radius:16px;border:none;font-weight:600;cursor:pointer;box-shadow:0 4px 25px rgba(255,106,0,.4)}
    .apple{background:#000;color:#fff}.google{background:#fff;color:#000}.phone{background:var(--orange);color:#000}

    #main{display:none;height:100vh;display:grid;grid-template-columns:300px 1fr}
    .sidebar{background:var(--dark);border-right:1px solid #333;overflow-y:auto;padding:15px 0;transition:transform .3s}
    .newchat{margin:15px;padding:15px;background:var(--orange);color:#000;border:none;border-radius:14px;font-weight:700;box-shadow:0 0 20px var(--glow)}
    .chatitem{padding:14px 20px;cursor:pointer;transition:.2s}
    .chatitem:hover,.chatitem.active{background:rgba(255,106,0,.2)}

    .chat{background:var(--bg);display:flex;flex-direction:column}
    .header{padding:15px;text-align:center;font-size:22px;font-weight:800;color:var(--orange);text-shadow:0 0 12px var(--glow)}
    .messages{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:12px}
    .msg{max-width:85%;padding:14px 18px;border-radius:20px;line-height:1.5;word-break:break-word}
    .user{align-self:flex-end;background:var(--orange);color:#000;border-bottom-right-radius:4px}
    .bot{align-self:flex-start;background:var(--dark);border-bottom-left-radius:4px}
    .typing{color:#888;font-style:italic}

    .inputbar{padding:12px;background:rgba(17,17,26,.97);border-top:1px solid #333;position:relative}
    #input{width:100%;padding:16px 70px 16px 55px;background:#222;border:1px solid #444;border-radius:28px;color:#fff;font-size:16px;outline:none}
    .plus{all:unset;position:absolute;left:18px;top:16px;font-size:30px;cursor:pointer;color:var(--orange)}
    .send{all:unset;position:absolute;right:12px;top:12px;background:var(--orange);width:48px;height:48px;border-radius:50%;display:grid;place-items:center;font-size:24px;box-shadow:0 0 20px var(--glow);cursor:pointer}

    .menu{position:fixed;bottom:80px;left:10px;right:10px;background:rgba(20,20,35,.98);border:1px solid var(--orange);border-radius:18px;padding:10px 0;box-shadow:0 0 40px rgba(255,106,0,.6);display:none;z-index:100}
    .mitem{padding:16px 22px;color:#fff;font-size:16px;display:flex;align-items:center;cursor:pointer}
    .mitem:hover{background:rgba(255,106,0,.2)}
  </style>
</head>
<body>
  <div id="particles"></div>

  <!-- АВТОРИЗАЦИЯ -->
  <div id="auth">
    <div class="logo">mrlOnsf</div>
    <button class="abtn apple">Войти через Apple</button>
    <button class="abtn google">Войти через Google</button>
    <button class="abtn phone">Войти по номеру</button>
  </div>

  <!-- ОСНОВНОЙ ЭКРАН -->
  <div id="main">
    <div class="sidebar" id="sidebar">
      <button class="newchat">＋ Новая беседа</button>
      <div id="chatlist"></div>
    </div>
    <div class="chat">
      <div class="header">mrlOnsf</div>
      <div class="messages" id="messages"></div>
      <div class="inputbar">
        <button class="plus">＋</button>
        <input type="text" id="input" placeholder="Напиши сообщение...">
        <button class="send">Send</button>
      </div>
    </div>
  </div>

  <!-- МЕНЮ + -->
  <div class="menu" id="menu">
    <div class="mitem" data-mode="video">Видео (Kling AI)</div>
    <div class="mitem" data-mode="image">Картинка (Flux)</div>
    <div class="mitem" data-mode="ppt">Презентация</div>
    <div class="mitem" data-mode="recipe">Рецепт + калории</div>
    <div class="mitem" data-mode="music">Музыка (Suno)</div>
  </div>

  <script>
    const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
    const auth = document.getElementById('auth');
    const main = document.getElementById('main');
    const messages = document.getElementById('messages');
    const input = document.getElementById('input');
    const sidebar = document.getElementById('sidebar');
    let mode = null;
    let chats = JSON.parse(localStorage.getItem('mrlOnsf_chats') || '[]');
    let currentChatId = null;

    // КУБИКИ
    document.addEventListener('pointermove', e => {
      const c = document.createElement('div');
      c.className = 'cube';
      c.style.left = (e.clientX - 5) + 'px';
      c.style.top = (e.clientY - 5) + 'px';
      document.getElementById('particles').appendChild(c);
      setTimeout(() => c.remove(), 3000);
    });

    // ВХОД
    document.querySelectorAll('#auth button').forEach(b => b.onclick = () => {
      auth.style.display = 'none';
      main.style.display = 'grid';
      if (!chats.length) createChat();
      else openChat(chats[chats.length-1].id);
    });

    // ЧАТЫ
    function createChat() {
      const id = Date.now();
      chats.push({id, title: 'Новая беседа', messages: []});
      save(); openChat(id);
    }
    function openChat(id) {
      currentChatId = id;
      messages.innerHTML = '';
      const chat = chats.find(c => c.id === id);
      chat.messages.forEach(m => addMsg(m.text, m.role));
      renderSidebar();
      messages.scrollTop = messages.scrollHeight;
    }
    function renderSidebar() {
      const list = document.getElementById('chatlist');
      list.innerHTML = '';
      chats.forEach(c => {
        const el = document.createElement('div');
        el.className = 'chatitem' + (c.id === currentChatId ? ' active' : '');
        el.textContent = c.title || 'Новая беседа';
        el.onclick = () => openChat(c.id);
        list.appendChild(el);
      });
    }
    function save() { localStorage.setItem('mrlOnsf_chats', JSON.stringify(chats)); }
    document.querySelector('.newchat').onclick = createChat;

    // СООБЩЕНИЯ
    function addMsg(text, role) {
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.innerHTML = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    // СВАЙП ВЛЕВО — скрыть сайдбар
    let touchStartX = 0;
    document.query aElement.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
    document.addEventListener('touchmove', e => {
      if (touchStartX < 60) {
        const delta = e.touches[0].clientX - touchStartX;
        if (delta > 100) sidebar.style.transform = 'translateX(-100%)';
      }
    });
    sidebar.addEventListener('click', () => sidebar.style.transform = 'translateX(0)');

    // ОТПРАВКА + GPT-4o
    async function send() {
      const text = input.value.trim();
      if (!text) return;
      addMsg(text, 'user');
      input.value = '';
      const typing = addMsg('<i class="typing">mrlOnsf думает...</i>', 'bot');

      try {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer sk-svcacct-HbAD6yrktAx3QioVwQbbeaCTlG5hPJNrr1-J1dE7hSvaUSYekqaV23Fl, FlFepZuEdKD1eS3V9tJZT3BlbkFJxmHwmt_inwtMOB6MiF8z3yCnH0pw-LtmgNBywdHVQ0ZHrW0MC3e6stcnVDJGd6dplgbcVmXZYA'
          },
          body: JSON.stringify({
            model: "gpt-4o",
            messages: [{role: "user", content: text}],
            temperature: 0.8
          })
        });
        const data = await res.json();
        const reply = data.choices[0].message.content;

        typing.remove();
        addMsg(reply, 'bot');

        const chat = chats.find(c => c.id === currentChatId);
        chat.messages.push({role: 'user', text}, {role: 'bot', text: reply});
        if (chat.messages.length === 2) chat.title = text.slice(0, 30);
        save(); renderSidebar();
      } catch (e) {
        typing.remove();
        addMsg("Сервер спит, но скоро проснётся", 'bot');
      }
    }

    document.querySelector('.send').onclick = send;
    input.addEventListener('keydown', e => e.key === 'Enter' && send());

    // МЕНЮ +
    document.querySelector('.plus').onclick = () => {
      document.getElementById('menu').style.display =
        document.getElementById('menu').style.display === 'block' ? 'none' : 'block';
    };
    document.querySelectorAll('.mitem').forEach(item => {
      item.onclick = () => {
        mode = item.dataset.mode;
        document.getElementById('menu').style.display = 'none';
        input.placeholder = item.textContent + '...';
        input.focus();
      };
    });

    // АВТОЗАГРУЗКА
    if (chats.length) {
      auth.style.display = 'none';
      main.style.display = 'grid';
      openChat(chats[chats.length-1].id);
    }
  </script>
</body>
</html>
  </script>
</body>
</html>
