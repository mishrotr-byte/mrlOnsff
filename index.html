<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>mrlOnsf</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #0a0a14;
      --dark: #11111a;
      --orange: #ff6a00;
      --orange-glow: #ff8c33;
      --text: #f0f0f0;
    }
    body { margin:0; height:100vh; overflow:hidden; background:var(--bg); color:var(--text); font-family: -apple-system, system-ui, sans-serif; }
    #particles { position:fixed; inset:0; pointer-events:none; z-index:1; }
    .cube { position:absolute; width:10px; height:10px; background:var(--orange); box-shadow:0 0 20px var(--orange-glow); border-radius:2px; animation:float 4s infinite; }
    @keyframes float { 0%,100%{opacity:0.8; transform:translateY(0) rotate(0)} 50%{opacity:1; transform:translateY(-25px) rotate(180deg)} }

    /* ==== ЭКРАН АВТОРИЗАЦИИ ==== */
    #auth-screen {
      position:fixed; inset:0; background:var(--bg); z-index:999; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:30px;
    }
    .logo { font-size:52px; font-weight:900; background:linear-gradient(45deg, #ff6a00, #ff8c33); -webkit-background-clip:text; color:transparent; }
    .auth-btn {
      width:280px; padding:16px; border-radius:16px; border:none; font-size:17px; font-weight:600; margin:8px; cursor:pointer;
      box-shadow:0 4px 20px rgba(255,106,0,0.3);
    }
    .apple { background:#000; color:white; }
    .google { background:#fff; color:#000; }
    .phone { background:var(--orange); color:black; }
    .email { background:var(--dark); color:var(--orange); border:2px solid var(--orange); }

    /* ==== ОСНОВНОЙ ИНТЕРФЕЙС ==== */
    #main { display:none; height:100vh; }
    .layout { display:grid; grid-template-columns:280px 1fr; height:100vh; }
    .sidebar {
      background:var(--dark); border-right:1px solid #333; padding:15px 0; overflow-y:auto;
      display:flex; flex-direction:column;
    }
    .new-chat {
      margin:15px; padding:14px; background:var(--orange); color:black; border:none; border-radius:12px; font-weight:600; box-shadow:0 0 15px var(--orange-glow);
    }
    .chat-item {
      padding:14px 20px; cursor:pointer; border-bottom:1px solid #222; transition:0.2s;
    }
    .chat-item:hover, .chat-item.active { background:rgba(255,106,0,0.2); }
    .chat-item span { font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; }

    .chat-area { display:flex; flex-direction:column; position:relative; }
    .header { padding:15px; text-align:center; font-size:20px; font-weight:800; color:var(--orange); text-shadow:0 0 10px var(--orange-glow); }
    .messages { flex:1; overflow-y:auto; padding:10px; }
    .msg { max-width:85%; margin:10px 0; padding:12px 18px; border-radius:18px; line-height:1.5; }
    .user { align-self:flex-end; background:var(--orange); color:black; border-bottom-right-radius:4px; }
    .bot { align-self:flex-start; background:var(--dark); border-bottom-left-radius:4px; }
    .input-bar {
      padding:10px; background:rgba(17,17,26,0.95); border-top:1px solid #333; position:relative;
    }
    #prompt { width:100%; padding:14px 60px 14px 50px; background:#222; border:1px solid #444; border-radius:25px; color:white; font-size:16px; outline:none; }
    .plus { position:absolute; left:15px; top:14px; background:none; border:none; font-size:28px; color:var(--orange); }
    .send { position:absolute; right:15px; top:10px; background:var(--orange); width:44px; height:44px; border-radius:50%; border:none; font-size:22px; box-shadow:0 0 15px var(--orange-glow); }

    .menu {
      position:fixed; bottom:80px; left:10px; right:10px; background:rgba(20,20,35,0.98); border:1px solid var(--orange); border-radius:16px; padding:10px 0;
      box-shadow:0 0 30px rgba(255,106,0,0.5); display:none; z-index:100;
    }
    .menu-item { padding:14px 20px; color:white; font-size:16px; display:flex; align-items:center; }
    .menu-item span { margin-left:15px; }
  </style>
</head>
<body>

  <!-- КУБИКИ ЗА ПАЛЬЦЕМ -->
  <div id="particles"></div>

  <!-- ЭКРАН АВТОРИЗАЦИИ -->
  <div id="auth-screen">
    <div class="logo">mrlOnsf</div>
    <button class="auth-btn apple"> Войти через Apple</button>
    <button class="auth-btn google">G Войти через Google</button>
    <button class="auth-btn phone">✆ Войти по номеру</button>
    <button class="auth-btn email">✉ Войти по почте</button>
    <div style="margin-top:30px; color:#888; font-size:14px;">Уже есть аккаунт? <span style="color:var(--orange)">Вход / Сменить аккаунт</span></div>
  </div>

  <!-- ГЛАВНЫЙ ЭКРАН -->
  <div id="main">
    <div class="layout">
      <!-- БОКОВАЯ ПАНЕЛЬ -->
      <div class="sidebar" id="sidebar">
        <button class="new-chat">＋ Новая беседа</button>
        <div id="chat-list"></div>
      </div>

      <!-- ЧАТ -->
      <div class="chat-area">
        <div class="header">mrlOnsf</div>
        <div class="messages" id="messages"></div>
        <div class="input-bar">
          <div style="position:relative;">
            <button class="plus" id="plus">＋</button>
            <input type="text" id="prompt" placeholder="Напиши сообщение...">
            <button class="send" id="send">➤</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- МЕНЮ ФУНКЦИЙ -->
  <div class="menu" id="menu">
    <div class="menu-item" data-mode="video">Генерация видео</div>
    <div class="menu-item" data-mode="image">Генерация картинки</div>
    <div class="menu-item" data-mode="ppt">Презентация PowerPoint</div>
    <div class="menu-item" data-mode="recipe">Рецепт + калории</div>
    <div class="menu-item" data-mode="camera">Камера → арт</div>
    <div class="menu-item" data-mode="music">Сгенерировать трек</div>
    <div class="menu-item" data-mode="voice">Голос → текст</div>
    <div class="menu-item" data-mode="avatar">Сделать аватарку</div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    const authScreen = document.getElementById('auth-screen');
    const main = document.getElementById('main');
    const messagesDiv = document.getElementById('messages');
    const promptInput = document.getElementById('prompt');
    const chatList = document.getElementById('chat-list');
    let currentMode = null;
    let currentChatId = null;
    let chats = JSON.parse(localStorage.getItem('mrlOnsf_chats') || '[]');

    // === КУБИКИ ЗА ПАЛЬЦЕМ ===
    document.addEventListener('pointermove', e => {
      const c = document.createElement('div');
      c.className = 'cube';
      c.style.left = (e.clientX - 5) + 'px';
      c.style.top = (e.clientY - 5) + 'px';
      document.getElementById('particles').appendChild(c);
      setTimeout(() => c.remove(), 3000);
    });

    // === АВТОРИЗАЦИЯ (пока просто клик = вход) ===
    document.querySelectorAll('.auth-btn, .auth-btn + div span').forEach(btn => {
      btn.onclick = () => {
        authScreen.style.display = 'none';
        main.style.display = 'flex';
        loadChats();
        if (chats.length === 0) createNewChat();
        else openChat(chats[chats.length - 1].id);
      };
    });

    // === ЧАТЫ ===
    function saveChats() {
      localStorage.setItem('mrlOnsf_chats', JSON.stringify(chats));
    }

    function createNewChat() {
      const id = Date.now();
      const newChat = { id, title: 'Новая беседа', messages: [] };
      chats.push(newChat);
      saveChats();
      openChat(id);
      renderChatList();
    }

    function openChat(id) {
      currentChatId = id;
      const chat = chats.find(c => c.id === id);
      messagesDiv.innerHTML = '';
      chat.messages.forEach(m => addMessage(m.text, m.role));
      renderChatList();
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function renderChatList() {
      chatList.innerHTML = '';
      chats.forEach(c => {
        const div = document.createElement('div');
        div.className = 'chat-item' + (c.id === currentChatId ? ' active' : '');
        div.innerHTML = `<span>${c.title || 'Новая беседа'}</span>`;
        div.onclick = () => openChat(c.id);
        chatList.appendChild(div);
      });
    }

    document.querySelector('.new-chat').onclick = createNewChat;

    // === СООБЩЕНИЯ ===
    function addMessage(text, role) {
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.innerHTML = text;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function sendMessage() {
      const text = promptInput.value.trim();
      if (!text) return;
      addMessage(text, 'user');
      promptInput.value = '';

      const typing = addMessage('<i style="color:#888">mrlOnsf думает...</i>', 'bot');
      setTimeout(() => {
        typing.remove();

        // Здесь будет настоящий ИИ (Grok, Claude, Llama 3 и т.д.)
        let reply = 'Это пока заглушка, но скоро я стану самым умным ботом в Telegram ';
        if (currentMode === 'recipe' && text.toLowerCase().includes('карбонара')) {
          reply = `Паста Карбонара (на 2 порции)\n\n• Спагетти 200 г\n• Гуанчиале 150 г\n• Яйца 2 + 2 желтка\n• Пекорино 80 г\n• Перец\n\nКалорийность: ≈ 820 ккал/порция\n\nГотовится 12 минут `;
        }
        addMessage(reply, 'bot');

        // Сохраняем
        const chat = chats.find(c => c.id === currentChatId);
        chat.messages.push({role: 'user', text}, {role: 'bot', text: reply});
        if (!chat.title) chat.title = text.substring(0, 30);
        saveChats();
        renderChatList();
      }, 1500);
    }

    document.getElementById('send').onclick = sendMessage;
    promptInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());

    // Меню +
    document.getElementById('plus').onclick = () => {
      document.getElementById('menu').style.display =
        document.getElementById('menu').style.display === 'block' ? 'none' : 'block';
    };
    document.querySelectorAll('.menu-item').forEach(item => {
      item.onclick = () => {
        currentMode = item.dataset.mode;
        document.getElementById('menu').style.display = 'none';
        promptInput.placeholder = item.textContent.trim() + '...';
        promptInput.focus();
      };
    });

    // Первая загрузка
    if (chats.length > 0) {
      authScreen.style.display = 'none';
      main.style.display = 'flex';
      loadChats();
      openChat(chats[chats.length - 1].id);
    }
  </script>
</body>
</html>
